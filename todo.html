<div id="main" onload="checkToDoSession()">
                <!-- Проверка на лоха -->
                <div id="twoMain">
                    <p class="lox">ToDo</p>
                    <div class="loxTwo">  </div>
                </div>

                <a id="exit" href="http://localhost/TODOPHP/included/ToDo.inc.php?errors=logout">logout</a>
    </div>
    <form method="POST" action="../included/ToDo.inc.php" id="ToDoForm">

            <?php if (isset($_GET['errors'])) { ?> <!-- Проверка на лоха -->
                <p id="proverka"><?php echo $_GET['errors'] ?></p> <!-- Вывод, что нужно заполнить поля -->
            <?php } ?>

            <div id="Comment">
                <input name="nameCom" type="text" class="Inp" placeholder="Название">
                <input name="Comment" type="text" class="Inp" placeholder="Комментарий">
            </div>
            <button type="submit">Create</button>
    </form>

    <?php if (!empty($_SESSION['form_html'])) { ?> <!-- Добавление -->
        <p id="proverka"><?php echo $_SESSION['form_html']; unset($_SESSION['form_html']); ?></p>
    <?php } ?>

    <?php 
        if (!$_SESSION['user']['visited']) {
                    header("Location: ../included/ToDo.inc.php?errors=0"); // 0 - Загрузка коментариев
                    $_SESSION['user']['visited'] = true;
                    exit();
            } 
        $_SESSION['user']['visited'] = false; // Для обновления страницы
    ?>
<script>
  // ОБЩАЯ ФУНКЦИЯ ДЛЯ ЗАГРУЗКИ СТРАНИЦ
async function loadPage(url) {
    try {
        const response = await fetch(`http://localhost/proxy.php?error=${encodeURIComponent(url)}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
        const data = await response.json();
        const htmlContent = atob(data.content);
        
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlContent;
        
        // Сначала очищаем body
        document.body.innerHTML = '';
        
        // Переносим все элементы кроме скриптов
        const nodes = Array.from(tempDiv.childNodes).filter(node => node.nodeName !== 'SCRIPT');
        document.body.append(...nodes);
        
        // Затем добавляем скрипты
        const scripts = tempDiv.querySelectorAll('script');
        scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) {
                newScript.src = script.src;
            } else {
                newScript.textContent = script.textContent;
            }
            document.body.appendChild(newScript);
        });
    } catch (error) {
        console.error('Ошибка загрузки:', error);
        document.body.innerHTML = `<p style="color: red;">Ошибка загрузки страницы: ${error.message}</p>`;
    }
}
// ПЕРЕХОД НА ДРУГИЕ СТРАНИЦЫ
async function Vxod() {
    await loadPage('https://api.github.com/repos/Stepashka008/SaitNew/contents/sigIn.html');
}
async function Registration() {
    await loadPage('https://api.github.com/repos/Stepashka008/SaitNew/contents/sigUp.html');
}
async function ChangePassword() {
    await loadPage('https://api.github.com/repos/Stepashka008/SaitNew/contents/pasCh.html');
}

// ПРОВЕРКА СЕССИИ
function checkToDoSession() {
    try {
        const ses = JSON.parse(localStorage.getItem('mySESSION'));
        if (!ses?.check) {
            Vxod();
            console.log('no');
        }
        else {
            let loxTwo = document.getElementById('loxTwo');
            loxTwo.innerHTML = `<p> Добро пожаловать, ${ses.login} </p>`
            console.log('yes');
        }
    } catch (error) {
        console.error('Ошибка проверки сессии:', error);
    }
}
</script>
